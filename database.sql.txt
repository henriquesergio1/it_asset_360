-- IT Asset 360 - Script Completo de Banco de Dados (SQL Server)
-- Versão: 2.13.0
-- Este script contém todas as tabelas necessárias para o funcionamento inicial do sistema.

-- Tabela de Dispositivos
CREATE TABLE Devices (
    Id NVARCHAR(255) PRIMARY KEY,
    AssetTag NVARCHAR(255) UNIQUE,
    Status NVARCHAR(50),
    PreviousStatus NVARCHAR(50) NULL,
    ModelId NVARCHAR(255),
    SerialNumber NVARCHAR(255),
    InternalCode NVARCHAR(255),
    Imei NVARCHAR(255) UNIQUE,
    PulsusId NVARCHAR(255),
    CurrentUserId NVARCHAR(255),
    SectorId NVARCHAR(255),
    CostCenter NVARCHAR(255),
    LinkedSimId NVARCHAR(255),
    PurchaseDate DATETIME,
    PurchaseCost FLOAT,
    InvoiceNumber NVARCHAR(255),
    Supplier NVARCHAR(255),
    PurchaseInvoiceUrl NVARCHAR(MAX),
    CustomData NVARCHAR(MAX)
);

-- Tabela de Chips (SIM Cards)
CREATE TABLE SimCards (
    Id NVARCHAR(255) PRIMARY KEY,
    PhoneNumber NVARCHAR(50) UNIQUE,
    Operator NVARCHAR(100),
    Iccid NVARCHAR(255) UNIQUE,
    Status NVARCHAR(50),
    CurrentUserId NVARCHAR(255),
    PlanDetails NVARCHAR(MAX)
);

-- Tabela de Colaboradores
CREATE TABLE Users (
    Id NVARCHAR(255) PRIMARY KEY,
    FullName NVARCHAR(255),
    Cpf NVARCHAR(50) UNIQUE,
    Rg NVARCHAR(50),
    Pis NVARCHAR(50),
    Address NVARCHAR(MAX),
    Email NVARCHAR(255) UNIQUE,
    SectorId NVARCHAR(255),
    InternalCode NVARCHAR(255),
    Active BIT,
    HasPendingIssues BIT,
    PendingIssuesNote NVARCHAR(MAX)
);

-- Tabela de Logs de Auditoria
CREATE TABLE AuditLogs (
    Id NVARCHAR(255) PRIMARY KEY,
    AssetId NVARCHAR(255),
    AssetType NVARCHAR(100),
    Action NVARCHAR(100),
    Timestamp DATETIME DEFAULT GETDATE(),
    AdminUser NVARCHAR(255),
    TargetName NVARCHAR(255),
    Notes NVARCHAR(MAX),
    BackupData NVARCHAR(MAX),
    PreviousData NVARCHAR(MAX),
    NewData NVARCHAR(MAX)
);

-- Tabela de Usuários do Sistema (Administradores/Operadores)
CREATE TABLE SystemUsers (
    Id NVARCHAR(255) PRIMARY KEY,
    Name NVARCHAR(255),
    Email NVARCHAR(255) UNIQUE,
    Password NVARCHAR(255),
    Role NVARCHAR(50)
);

-- Tabela de Configurações do Sistema
CREATE TABLE SystemSettings (
    Id INT PRIMARY KEY IDENTITY(1,1),
    AppName NVARCHAR(255),
    LogoUrl NVARCHAR(MAX),
    Cnpj NVARCHAR(50),
    TermTemplate NVARCHAR(MAX)
);

-- Tabela de Modelos de Ativos
CREATE TABLE Models (
    Id NVARCHAR(255) PRIMARY KEY,
    Name NVARCHAR(255),
    BrandId NVARCHAR(255),
    TypeId NVARCHAR(255),
    ImageUrl NVARCHAR(MAX)
);

-- Tabela de Marcas
CREATE TABLE Brands (
    Id NVARCHAR(255) PRIMARY KEY,
    Name NVARCHAR(255) UNIQUE
);

-- Tabela de Tipos de Ativos
CREATE TABLE AssetTypes (
    Id NVARCHAR(255) PRIMARY KEY,
    Name NVARCHAR(255) UNIQUE,
    CustomFieldIds NVARCHAR(MAX)
);

-- Tabela de Registros de Manutenção
CREATE TABLE MaintenanceRecords (
    Id NVARCHAR(255) PRIMARY KEY,
    DeviceId NVARCHAR(255),
    Description NVARCHAR(MAX),
    Cost FLOAT,
    Date DATETIME,
    Type NVARCHAR(100),
    Provider NVARCHAR(255),
    InvoiceUrl NVARCHAR(MAX)
);

-- Tabela de Setores/Cargos
CREATE TABLE Sectors (
    Id NVARCHAR(255) PRIMARY KEY,
    Name NVARCHAR(255) UNIQUE
);

-- Tabela de Termos de Responsabilidade
CREATE TABLE Terms (
    Id NVARCHAR(255) PRIMARY KEY,
    UserId NVARCHAR(255),
    Type NVARCHAR(50),
    AssetDetails NVARCHAR(MAX),
    Date DATETIME,
    FileUrl NVARCHAR(MAX)
);

-- Tabela de Tipos de Acessórios
CREATE TABLE AccessoryTypes (
    Id NVARCHAR(255) PRIMARY KEY,
    Name NVARCHAR(255) UNIQUE
);

-- Tabela de Acessórios Vinculados a Dispositivos
CREATE TABLE DeviceAccessories (
    Id NVARCHAR(255) PRIMARY KEY,
    DeviceId NVARCHAR(255),
    AccessoryTypeId NVARCHAR(255),
    Name NVARCHAR(255)
);

-- Tabela de Campos Personalizados
CREATE TABLE CustomFields (
    Id NVARCHAR(255) PRIMARY KEY,
    Name NVARCHAR(255) UNIQUE
);

-- Tabela de Contas e Licenças de Software
CREATE TABLE SoftwareAccounts (
    Id NVARCHAR(255) PRIMARY KEY,
    Name NVARCHAR(255),
    Type NVARCHAR(100),
    Login NVARCHAR(255),
    Password NVARCHAR(255),
    AccessUrl NVARCHAR(MAX),
    Status NVARCHAR(50),
    UserId NVARCHAR(255),
    DeviceId NVARCHAR(255),
    SectorId NVARCHAR(255),
    Notes NVARCHAR(MAX)
);

-- Populando dados iniciais essenciais
INSERT INTO SystemSettings (AppName, LogoUrl) VALUES ('IT Asset 360', '');

PRINT 'Banco de dados inicializado com sucesso.';

